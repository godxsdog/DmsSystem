# N2邏輯新增 & 報表修正開發清單

## 開發項目總覽

| 程式代碼 | 功能名稱 | 優先順序 | 預估天數 | 開發分析 |
|---------|---------|---------|---------|---------|
| DMS23 | 投資型保單撥回設定 新增N2級別撥回資料匯入功能 | 1 | 3 | 新增N2級別投資型保單撥回資料管理功能，包含撥回資料匯入、匯出及維護作業。使用者可針對N2級別基金設定撥回日期、撥回金額、單位數等資料，並可匯出Excel檔案進行外部編輯後再匯入系統。此功能位於契約登錄作業的第26個分頁「投資型N2撥回設定」，需新增CONTRACT_DIVIDEND_N2資料表的相關操作，包含資料新增、修改、刪除及批次匯入功能。系統需驗證匯入資料的正確性，包含日期格式、金額格式等，並提供錯誤訊息提示。此報表有26個分頁，結構較複雜，需仔細處理各頁面間的資料關聯性。 |
| DMS65718 | 全委帳戶與Benchmark比較表 新增N2級別報表 | 1 | 2.5 | 新增N2級別全委帳戶與基準指數比較報表功能，可查詢N2級別基金與各類Benchmark指數的績效比較，包含今年以來漲跌幅、配息資料、累計報酬率等。報表需依N2級別基金的契約生效日計算起算日，並正確處理N2級別配息資料的累計計算。需新增d_dms65718_n2及d_dms65718_n2_ns兩個DataWindow物件，分別對應顯示與不顯示今年以來漲跌幅兩種報表格式。查詢視窗需新增N2級別選項，並修改SQL查詢邏輯，正確過濾N2級別基金資料，計算N2級別基金與各Benchmark指數的績效差異。報表需支援匯出Excel功能，檔案名稱預設為DMS65718_N2.XLS。 |
| DMS6571B | 全委契約資產異動報表 新增N2級別報表 | 1 | 2 | 新增N2級別全委契約資產異動查詢功能，可查詢N2級別基金在指定日期區間的資產變動情況，包含淨資產、單位數、淨值等資料，並計算N2級別配息對資產的影響。查詢視窗已定義N2級別選項(rpt_type2='4')，需實作N2級別資料查詢邏輯，修改SQL查詢條件過濾N2級別基金資料，並處理CONTRACT_DIVIDEND_N2配息資料的計算。報表需正確計算N2級別基金在指定日期區間的資產變動，包含期初淨資產、期末淨資產、期間配息金額等資訊。系統需支援依委託人ID、契約序號、日期範圍等條件查詢，並可匯出Excel檔案供進一步分析使用。 |
| DMS6571A | 類全委客戶績效報告 新增N2級別報表 | 1 | 2 | 新增N2級別類全委客戶績效查詢功能，可查詢N2級別基金的投資績效表現，包含淨值變動、配息收益、累計報酬率等資訊。報表需支援依委託人ID、契約序號、交易日期、成交單號、券商代號等條件查詢N2級別基金的績效資料。需修改查詢視窗新增N2級別選項，並修改主報表視窗支援N2級別資料查詢。系統需正確計算N2級別基金的績效指標，包含期間報酬率、年化報酬率等，並處理N2級別配息資料對績效的影響。報表需支援列印及匯出功能，並可依使用者需求調整報表格式。 |
| DMS756 | 停損報告控管表 新增N2級別支援 | 1 | 2 | 新增N2級別停損控管查詢功能，可查詢N2級別基金的停損比率控管狀況，包含折損比率、股票代號、股票名稱、持股數量、淨值等資訊。報表需支援依委託人ID、契約序號、日期範圍、經理人、基金類型等條件查詢N2級別基金的停損控管資料。需修改查詢視窗新增N2級別選項，並修改主報表支援N2級別資料查詢。系統需正確計算N2級別基金的停損比率，並依設定的折損比率進行控管警示。報表需支援匯出Excel功能，檔案路徑可由使用者指定，預設為C:\TEMP\DMS756.XLS。報表需正確顯示N2級別基金的停損控管資訊，協助使用者進行風險管理。 |
| DMS593916 | 申購贖回入帳明細表 新增N2級別報表 | 1 | 1.5 | 新增N2級別申購贖回入帳明細查詢功能，可查詢N2級別基金的申購、贖回交易明細及入帳資料。報表需正確過濾N2級別基金資料，顯示交易日期、成交單號、申購金額、贖回金額、單位數、淨值等明細資訊。需新增d_dms593916_new_n2 DataWindow物件，並修改查詢條件過濾N2級別基金資料(ab_shares_type='3' and NAME like '%N2%')。查詢視窗需新增N2級別選項，讓使用者可選擇查詢母基金、一般級別或N2級別。報表需支援依委託人ID、契約序號、交易日期等條件查詢，並可匯出Excel檔案。系統需正確計算N2級別基金的申購贖回金額，並顯示入帳明細供使用者核對。 |

## 開發總天數
**總計：13天** (在15天預算範圍內)

## 開發重點說明

### 共同開發模式
所有報表需仿照現有N1級別實作方式，主要修改點包括：
1. 查詢視窗新增N2級別選項
2. 修改SQL查詢條件，過濾N2級別基金資料
3. 處理CONTRACT_DIVIDEND_N2配息資料表
4. 新增或修改對應的DataWindow物件

### 資料表變更
- 需確認CONTRACT_DIVIDEND_N2資料表結構與CONTRACT_DIVIDEND_N1相同
- 需確認V_CONTRACT_AB_Fund視圖支援N2級別查詢(NLevel='N2')

### 優先順序
所有項目優先順序均為1，建議按開發天數由長到短依序開發，以確保複雜度高的項目有足夠時間完成。

