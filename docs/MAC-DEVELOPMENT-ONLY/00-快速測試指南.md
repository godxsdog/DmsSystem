# Mac 環境快速測試指南

## 🎯 測試目標

本指南將帶您完成完整的系統測試，包括：
1. 啟動系統（資料庫、API、前端）
2. 上傳測試檔案
3. 在網頁上查看資料
4. 驗證資料庫資料

---

## 📋 前置準備

### 1. 確認環境

```bash
# 檢查 .NET SDK
dotnet --version
# 應該顯示 8.0.x

# 檢查 Node.js
node --version
# 應該顯示 v18.x 或更高

# 檢查 Docker
docker --version
# 應該顯示 Docker 版本資訊
```

### 2. 確認專案位置

```bash
cd /Users/kaichanghuang/Documents/Phoenix\ Code/DmsSystem
pwd
# 應該顯示：/Users/kaichanghuang/Documents/Phoenix Code/DmsSystem
```

---

## 🚀 步驟 1：啟動資料庫（Docker SQL Server）

### 1.1 啟動容器

```bash
cd /Users/kaichanghuang/Documents/Phoenix\ Code/DmsSystem
docker-compose up -d
```

### 1.2 等待 SQL Server 啟動

**等待 30-60 秒**讓 SQL Server 完全啟動

### 1.3 驗證資料庫運行

```bash
# 檢查容器狀態
docker ps | grep sqlserver

# 應該看到 dms-sqlserver 容器正在運行
```

### 1.4 測試資料庫連接

```bash
docker exec -it dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -Q "SELECT DB_NAME()"
```

**預期結果**：應該顯示 `DMS`

---

## 📊 步驟 2：載入測試資料

### 2.1 載入測試資料

```bash
# 複製測試資料腳本到容器
docker cp scripts/seed-test-data.sql dms-sqlserver:/tmp/seed-test-data.sql

# 執行腳本
docker exec -i dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -d DMS \
  -i /tmp/seed-test-data.sql
```

### 2.2 驗證資料已載入

```bash
# 檢查股東會明細資料
docker exec -it dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -d DMS \
  -Q "SELECT COUNT(*) FROM RIS.SHMT_SOURCE1"

# 應該看到數字（例如：3）
```

---

## 🔧 步驟 3：啟動後端 API

### 3.1 開啟新終端視窗

**重要**：保持資料庫終端視窗開啟，開啟新的終端視窗

### 3.2 啟動 API

```bash
cd /Users/kaichanghuang/Documents/Phoenix\ Code/DmsSystem/DmsSystem.Api
dotnet run
```

### 3.3 驗證 API 啟動

**預期輸出**：
```
[INF] 應用程式啟動完成
[INF] Now listening on: http://localhost:5137
```

### 3.4 測試 API（可選）

打開瀏覽器訪問：http://localhost:5137/swagger

應該看到 Swagger UI 介面，顯示所有 API 端點

---

## 🎨 步驟 4：啟動前端（React）

### 4.1 開啟新終端視窗

**重要**：保持資料庫和 API 終端視窗開啟，開啟第三個終端視窗

### 4.2 進入前端目錄

```bash
cd /Users/kaichanghuang/Documents/Phoenix\ Code/DmsSystem/react-client
```

### 4.3 安裝依賴（首次執行）

```bash
npm install
```

### 4.4 啟動前端開發伺服器

```bash
npm run dev
```

### 4.5 驗證前端啟動

**預期輸出**：
```
➜  Local:   http://localhost:5173/
```

---

## 🌐 步驟 5：在網頁上測試

### 5.1 打開瀏覽器

訪問：http://localhost:5173

### 5.2 查看首頁

應該看到：
- **標題**：DMS 系統
- **導航按鈕**：
  - 檔案上傳（預設選中）
  - 資料檢視

### 5.3 測試資料檢視功能

1. **點擊「資料檢視」按鈕**
2. **應該看到三個標籤頁**：
   - 股東會明細
   - 公司資訊
   - 股票餘額
3. **點擊各個標籤頁**，應該能看到對應的資料表格

**預期結果**：
- 如果已載入測試資料，應該能看到資料表格
- 如果沒有資料，會顯示「尚無資料」

### 5.4 測試檔案上傳功能

1. **點擊「檔案上傳」按鈕**回到上傳頁面
2. **測試股東會明細上傳**：
   - 點擊「選擇檔案」
   - 選擇一個 `.xlsx` 或 `.csv` 檔案
   - 點擊「上傳」按鈕
   - 應該看到成功訊息
3. **測試公司資訊上傳**：
   - 重複上述步驟
4. **測試股票餘額上傳**：
   - 重複上述步驟

### 5.5 驗證上傳後的資料

1. **上傳完成後，點擊「資料檢視」**
2. **切換到對應的標籤頁**
3. **應該能看到剛才上傳的資料**

---

## 🔍 步驟 6：驗證資料庫資料

### 6.1 檢查股東會明細資料

```bash
docker exec -it dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -d DMS \
  -Q "SELECT TOP 5 * FROM RIS.SHMT_SOURCE1"
```

### 6.2 檢查公司資訊資料

```bash
docker exec -it dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -d DMS \
  -Q "SELECT TOP 5 * FROM RIS.SHMT_SOURCE4"
```

### 6.3 檢查股票餘額資料

```bash
docker exec -it dms-sqlserver /opt/mssql-tools/bin/sqlcmd \
  -S localhost \
  -U sa \
  -P 'DmsSystem@2024' \
  -d DMS \
  -Q "SELECT TOP 5 * FROM DMS.STOCK_BALANCE"
```

---

## ✅ 測試檢查清單

### 系統啟動
- [ ] Docker SQL Server 容器運行中
- [ ] 後端 API 在 http://localhost:5137 運行
- [ ] 前端在 http://localhost:5173 運行
- [ ] Swagger UI 可訪問（http://localhost:5137/swagger）

### 資料檢視功能
- [ ] 「資料檢視」頁面可以打開
- [ ] 「股東會明細」標籤頁可以顯示資料
- [ ] 「公司資訊」標籤頁可以顯示資料
- [ ] 「股票餘額」標籤頁可以顯示資料
- [ ] 資料表格格式正確

### 檔案上傳功能
- [ ] 「檔案上傳」頁面可以打開
- [ ] 股東會明細上傳功能正常
- [ ] 公司資訊上傳功能正常
- [ ] 股票餘額上傳功能正常
- [ ] 上傳成功後顯示正確訊息
- [ ] 上傳失敗時顯示錯誤訊息

### 資料庫驗證
- [ ] 上傳的資料已正確寫入資料庫
- [ ] 資料庫中的資料與網頁顯示一致

---

## 🐛 常見問題

### Q1：前端無法連接 API

**症狀**：網頁顯示「載入中...」或錯誤訊息

**解決方法**：
1. 確認 API 正在運行（檢查終端視窗）
2. 確認 API URL 正確（http://localhost:5137）
3. 檢查瀏覽器開發者工具（F12）的 Console 和 Network 標籤

### Q2：資料檢視頁面顯示「尚無資料」

**可能原因**：
1. 尚未載入測試資料
2. 尚未上傳任何檔案

**解決方法**：
1. 執行步驟 2 載入測試資料
2. 或執行步驟 5.4 上傳測試檔案

### Q3：上傳檔案失敗

**檢查項目**：
1. 檔案格式是否正確（.xlsx 或 .csv）
2. 檔案大小是否超過限制（10MB）
3. API 是否正在運行
4. 查看 API 終端視窗的錯誤訊息

### Q4：資料庫連接失敗

**解決方法**：
1. 確認 Docker 容器正在運行：`docker ps | grep sqlserver`
2. 等待更長時間（SQL Server 需要 30-60 秒啟動）
3. 檢查連接字串（`appsettings.Development.json`）

---

## 📚 相關文件

- [Mac 開發環境完整手冊](./01-Mac開發環境完整手冊.md) - 完整的開發環境設定
- [測試資料載入](./02-測試資料載入.md) - 詳細的測試資料載入說明
- [Docker SQL Server 設定](./03-Docker-SQL-Server設定.md) - Docker 容器詳細設定

---

## 🎉 測試完成

如果所有檢查項目都通過，恭喜您！系統運行正常。

**下一步**：
- 可以開始進行功能開發
- 或參考 [Windows 快速開始](../00-快速開始.md) 準備切換到正式環境

