# Windows 環境資料庫配置指南

## 資料庫環境

**Windows 正式環境**：連接正式區 SQL Server

## 快速設定

### 1. 修改 appsettings.Production.json

**位置**：`DmsSystem.Api/appsettings.Production.json`

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=正式伺服器位址;Database=DMS;User Id=正式使用者;Password=正式密碼;TrustServerCertificate=True;MultipleActiveResultSets=True"
  }
}
```

**⚠️ 重要**：請替換為正式環境的實際連接資訊

### 2. 或使用環境變數（推薦，更安全）

**PowerShell**：
```powershell
$env:ConnectionStrings__DefaultConnection="Server=正式伺服器位址;Database=DMS;User Id=正式使用者;Password=正式密碼;TrustServerCertificate=True;MultipleActiveResultSets=True"
$env:ASPNETCORE_ENVIRONMENT="Production"
```

**命令提示字元（CMD）**：
```cmd
set ConnectionStrings__DefaultConnection=Server=正式伺服器位址;Database=DMS;User Id=正式使用者;Password=正式密碼;TrustServerCertificate=True;MultipleActiveResultSets=True
set ASPNETCORE_ENVIRONMENT=Production
```

## 連接字串格式說明

```
Server=<伺服器位址>,<埠號>;Database=<資料庫名稱>;User Id=<使用者名稱>;Password=<密碼>;TrustServerCertificate=True;MultipleActiveResultSets=True
```

### 參數說明

- **Server**: SQL Server 位址和埠號（正式環境）
- **Database**: 資料庫名稱（預設為 `DMS`）
- **User Id**: SQL Server 登入帳號
- **Password**: SQL Server 登入密碼
- **TrustServerCertificate**: 信任伺服器憑證
- **MultipleActiveResultSets**: 允許多個活動結果集

## 環境變數優先順序

ASP.NET Core 會依照以下順序載入設定（後面的會覆蓋前面的）：

1. `appsettings.json`
2. `appsettings.{Environment}.json`（例如 `appsettings.Production.json`）
3. 環境變數

## 設定 ASP.NET Core 環境

### Windows PowerShell
```powershell
$env:ASPNETCORE_ENVIRONMENT="Production"
```

### Windows CMD
```cmd
set ASPNETCORE_ENVIRONMENT=Production
```

## 驗證連接

### 使用 SQL Server Management Studio (SSMS)

1. 開啟 SSMS
2. 輸入伺服器位址、使用者名稱和密碼
3. 連接測試

### 使用命令列

```powershell
sqlcmd -S 正式伺服器位址 -U 正式使用者 -P 正式密碼 -d DMS -Q "SELECT DB_NAME()"
```

## 常見問題

### Q: 如何確認連接字串是否正確？

A: 執行應用程式時，如果連接字串錯誤，會在啟動時拋出例外。也可以使用 SQL Server Management Studio 或 `sqlcmd` 測試連接。

### Q: 如何保護生產環境的密碼？

A: 
1. 使用環境變數（推薦）
2. 使用 Azure Key Vault 或其他密碼管理服務
3. 不要在程式碼中硬編碼密碼

### Q: 連接失敗怎麼辦？

A: 檢查：
1. SQL Server 是否正在運行
2. 防火牆設定是否允許連接
3. 連接字串中的參數是否正確
4. 使用者帳號是否有足夠權限
5. 網路連線是否正常

### Q: 如何切換不同的資料庫？

A: 修改連接字串中的 `Database` 參數，或使用不同的環境變數設定。

## ⚠️ 重要提醒

- **此配置專為 Windows 正式環境設計**
- 請確保您有正式區 SQL Server 的連接權限
- 生產環境密碼請妥善保管，不要提交到版本控制系統
